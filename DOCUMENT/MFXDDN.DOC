

MFXDDN user's manual                                             ver.1.18DOC



mfxddn.doc
----------------------------------------------------------------------------
DOS汎用音源ドライバ
                       MFXDRV/DDN kernel version 1.18
          copyright (c) 1993,94,95 by T.Kobayashi / Interfair(DIL)
                            All Rights Reserved.

----------------------------------------------------------------------------

※はじめに

    ○どもども
          このたびは、 Interfair-TechPo(てひっぽ)project製品をdownload下さい
        ましてありがとうございます。このドライバは、私がゲームを作成するため
        に作った物です。ということで、いろいろ不備な点があると思いますが、末
        永く宜しくお願いします。

    ○MFXDRV/DDNってなんだろう?
          MFXDRV/DDN(以下DDN)は、 DOS が動作し、x86アーキテクチャを持ったCPU
        を持つパーソナルコンピュータで動作する音源ドライバです。従って、この
        ドライバ自体にハードウェアをいじる能力はなく、このドライバに組み込ま
        れた手足となるドライバを駆使して[*1]常駐演奏を行う形式のプログラムで
        す。以後、"XMML3.00"という語句が出てきますが、これは mplus というMML
        コンパイラの仕様がどんどん発展したもので、今ではMMLどころか、APIなど
        すべての仕様のことを指しています。 MMLだけではないので注意して下さい
        ね。

    ○DDNの特徴
         1. 同時に32トラック演奏できる。 1トラックでの同時発音数はドライバに
            よります。従って単純に考えると32種類の音色を同時にならせるという
            ことです。今の時勢を考えると少ないですね。

         2. 新音源が出たとき、すぐに対応できる。

         3. 98系DOSでもDOS/Vでも同じ曲データが使える。

         4. 外部ドライバの作成がお手軽。あやしい小判鮫ソフトウェアも簡単に作
            成可能。

         5. 豊富なAPI(なの?)、プログラマを意識した[*2]システムファンクション
            搭載。

         6. すべてアセンブリ言語で記述されていて、機能の割に常駐サイズが小さ
            い(自信なし(笑)) [*3] (約10K)。













                                   - 1 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


         7. 内部で far-call を無茶苦茶やってます[*4]ので遅くなりそうなんです
            が、他のドライバと大差ないレスポンス。...うーん、 やっぱりちょっ
            と遅いかもしれない(笑)。

※動作機種等

    ○動作機種
        DOSのアプリケーションが動作する80186以降のCPUを搭載した機種。186命令
        を使用しているためです。まぁ、なんにせよ今更8086な機械を動かす人もい
        ないでしょうから(笑)。開発は PC-9801RA21(Cx486DRx2)上で行いました。

    ○CPUのクロック
        内部でかなり多くのfar callを使用していますので、なるだけ速い機種で動
        作させることが望ましいです。でも、他のドライバと比べてみてもそんなに
        重くはないです。 理想は、386以降の機種ですね。98NOTEでもすかすか動い
        たのでそんなに気にしなくてもいいかもしれません。ドライバによっては重
        くなるかもしれません。

    ○前提ソフト
        MS-DOS version 3.10 以降、または同等以上の機能を持つ  OS上で動作しま
        す。 いずれはWindowsとか、Macintoshとかでも動かせるようにしたい(とい
        っても曲データが鳴る程度)ですね。

    ○必要メモリ
        本ドライバは、API処理および外部ドライバとの通信、 曲データの処理など
        でコードが約7K、データが約3Kのメモリを使用します。使用メモリはドライ
        バの供給情況によりますが、まぁ、MIDIをならすんだったら曲バッファも含
        めて64Kもあれば足りると思います。 ただし付属の常駐プレイヤは、曲バッ
        ファに64K使用します^^;

※インストール

    ○必要ファイル
        デフォルトで以下のファイルがまとめられています。
             eazy.doc        簡単な使い方
             mfxddn.doc      本ファイル
             mfxddn.com      MFXDRV/DDNカーネルシステム
             mfxddnl.com  MFXDRV/DDN  Light  カーネルシステム(演奏不可)
             mfxdrs.exe      XDVドライバステータスビュアー
             mld.exe         XDVドライバーローダー
             mip.exe         MUD演奏プログラム
             ml.exe          MBS,MBJオブジェクトリンカ
             slib.exe        音色ライブラリマネージャ
             filelink.exe    FILELINKマネージャ
             tech.lzh        テクニカルマニュアル(別途配布かも)

        ※ eazy.docを読むと、だいたい分かります(^^;)

        デフォルトでMFXDRV/DDNシステムが使用する拡張子の意味を定義しておきま
        す。








                                   - 2 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


             〜.exe 〜.com   各種実行プログラム
             〜.xdv          XDVドライバ(音源、タイマ、その他)
             〜.mud          楽曲ファイル(演奏可能)
             〜.eud          効果音ファイル
             〜.mbs          ソースオブジェクト
             〜.mbj          オブジェクト
             〜.sbj          音色オブジェクト
             〜.lis          音色ライブラリ
             〜.mmd          mPlus MMLスクリプト
             〜.mac          mPlus MML マクロスクリプト
















































                                   - 3 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


※操作、ファイルの説明

    ○MFXDRV/DDN カーネルについて
          MFXDRV/DDN システムを動作させるためには、DDNカーネルプログラムを常
        駐する必要があります。

          常駐は
        >mfxddn

          解放は
        >mfxddn /r

        です。
          常駐には約10Kのメモリを必要とします。また、割り込みベクタ int  50h
        及びint  51h を使用します。これらの割り込みを使用するTSR及びプログラ
        ムの併用はできません。

    ○XDVドライバローダー mld.exe について
          ただ、 mfxddn.com  を常駐しただけでは、 曲を演奏することはできませ
        ん。 [*5]各種ドライバを組み込んでやる必要があります。ドライバは、〜.
        xdv というファイルです。mld.exe というプログラムを用いて、組み込んで
        やる必要があります。

          midi.xdv の組み込み方法は、mfxddn.com が常駐している状態で次のよう
        に行います。
        >mld midi

          また、 複数のドライバを組み込むときは、,(コンマ)で区切って書いてい
        きます。
        >mld midi /p,itvtimer,ff, beat,lyric

          同じIDのドライバは組み込まれないようにしていますが、どうしても組み
        込みたい場合は、-w オプションで強制的に組み込むことが出来ます。
        >mld -w midi,beep /id=MIDI

          曲を演奏するためには、音源ドライバとタイマドライバを組み込む必要が
        あります。
        >mld midi,itvtimer

    ○常駐プレイヤー mld.exe について
          というわけで演奏ですが、 演奏には mip.exe というプログラムが梱包さ
        れていますので、これを使用しましょう。たとえば、gerogero.mud  を演奏
        したいときは、
        >mip gerogero.mud

-- note -----------------

 [*1] もちろん外部ドライバを常駐させる必要があります。

 [*2] 単に自分で使うのに面倒臭かったからこうしただけかも^^;

 [*3] うーん、そうかなぁ。

 [*4] 外部ドライバの時分割タスク制御、内部制御コマンドの発送など

 [*5] 演奏できたらすごいぞ。DOS汎用なのに(笑)。


                                   - 4 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


        で演奏できます。 ただし、曲に必要なXDVドライバが組み込まれていないと
        きは演奏できないので、注意して下さい。

          また、ファイル名を指定する代わりに各種オプションを記述して演奏をコ
        ントロールすることもできます。以下に使用できるオプションを書いておき
        ます。

             /s         演奏を停止する
             /p         演奏を一時停止する
             /c         演奏を再開する
             /f         演奏をフェードアウト終了する

          ※注意
          初回演奏開始時に、曲データバッファを 64K 確保します。 次回からはそ
        のメモリを用いて演奏します。このバッファは mfxddn.com 解放時に一緒に
        解放されます。 また、曲データバッファを 64K しか確保していないため、
        演奏データは 64K までに限ります。

    ○オブジェクトリンカ ml.exe について
          このプログラムは mbs、mbj、及び lis をリンクして楽曲データ  〜.mud
        を作成するプログラムです。 mbsは、リンクしたいオブジェクトのデータが
        入ったファイルで、mbjはオブジェクト本体です。
          たとえば、gero_mus.mbs gero_mus.mbj gero_wrd.mbj  をリンクしたいと
        きは次のようにします。
        >ml gero_mus.mbs gero_mus.mbj gero_wrd.mbj

          また、mlはオプティマイズ機能をもっていて、データの圧縮をかけること
        ができます。どうも改造したら動作が怪しくなってしまったので、使わない
        ほうが賢明です(おい)。ハングします。
        >ml -o gero_mus.mbs gero_mus.mbj gero_wrd.mbj

          ml.exeは、ml.exe の存在するディレクトリに、sound.lisという音色ライ
        ブラリファイルがあるとき、自動的に使用した音色をLINKする機能をもって
        います。....が、 曲データの中で音色設定を行っている場合、音色登録が2
        重になり正常な演奏が期待できません。そのような場合、-u  オプションで
        使用して、sound.lis をリンクしないようにしてください。
          例:birobiro.mmdの中で音色定義しているので、 音色ファイルを自動リン
        クしたくない場合。
        >mplus -lu birobiro.mmd

          または、

        >mplus -c birobiro.mmd
        >ml -u birobiro.mbs birobiro.mbj

          普通このプログラムは、各種コンパイラ、コンバータなどから自動的に呼
        ばれますので、必ず path の通ったディレクトリに入れて置いて下さい。き
        わめた使い方をする人以外は、まったく使わなくてもいいコマンドです。

    ○音色ライブラリマネージャ slib.exe について
          このプログラムは 音色オブジェクトファイル〜.sbjを統合して、 音色ラ
        イブラリファイル〜.lisを作成するプログラムです。
          音色ライブラリファイルをml.exeと同じディレクトリに格納しておくこと
        により、楽曲で使用した音色及びドライバをもとに、〜.mudファイルに自動
        的にリンクします。
          音色のライブラリ化は、 たとえば OPN音色ファイルまたは、SSG音色ファ


                                   - 5 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


        イルをそれぞれopn.sbj、ssg.sbjとし、 ライブラリファイルをsound.lisと
        すると、
        >slib sound.lis +opn.sbj +ssg.sbj
        とします。

          ファイル名の先頭に付加している "+" は、sound.lisに結合しなさいとい
        う修飾子です。他にも以下の修飾子が使用可能です。

             +               結合
             -               削除
             -+ , +-         入れ替え
             *- , -*         抽出後削除

    ○FILELINKマネージャ filelink.exe について
          EXEファイルとドライバを一体化[*6]するために必要なツール[*7]です。
        このツールだけでは一体化はできないので、 注意して下さい。方法は、C言
        語用の制御ライブラリ(ddnlib)の中にかいてあると思います。 Interfair製
        のプログラムは、このFILELINKマネージャで分解可能です^^;; (ヒミツだよ
        (おい))。
        >filelink x solude.exe
        いくつか〜.mudファイルがあるので、   演奏してみてください。   ただし
        bombtank.exe に入っているmudファイルは、XMML2.00仕様なので演奏できま
        せん。

    ○テクニカルマニュアル tech.lzh について
          XMML3.00の全仕様及びファイル構造、XDVドライバ仕様、APIリストなどが
        詰まっています。
             api.doc         XMML3.00-API一覧
             mld.doc         MLD-API一覧
             xdv.doc         XDVドライバの組み方
             usl_drv.doc     XDVドライバ〜音源ドライバ〜の仕様書
             tim_drv.doc     XDVドライバ〜タイマドライバ〜の仕様書
             etc_drv.doc     XDVドライバ〜その他ドライバ〜の仕様書
             mud.doc         MUDファイル構造
             mbs.doc         MBSファイル構造
             mbj.doc         MBJファイル構造
             bin.doc         MUDファイルのデータ部分
             bufchain.doc    バッファチェインメモリー機能の解説
             ecm.doc         ECM(Extend controll message)機能の解説












-- note -----------------

 [*6] つまり、1つのファイルにまとめてしまうってことです。

 [*7] 多目的に使用中(笑)。


                                   - 6 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC



※著作権、利用条件など。
    ○開発環境
          プログラム作成に、以下のアプリケーションを用いて作成しました。

             Machine PC9801RA21/Cx486DLC and P5-100M AT互換機  さんきゅ
             C++ Compiler       Turbo-C++ ver.1.01
             Assembler          Turbo Assembler ver.2.0
             Library manager    tlib.exe
             EXEfile linker     tlink.exe
             TEXT Editor        vz.com ver.1.57


          ドキュメント作成に、以下のアプリケーション用いて作成しました。

             TEXT formatter     ntf.exe
             Kanji code Filter  nkf (UNIX版)


          ntfで書くと、文章をぽんぽんかけるので非常にありがたいです(笑)。 作
        者に tomoyuki niijimaさんに感謝いたします^^;。
          いろいろご助言下さった ISL-NETの方々に深く感謝いたします。

    ○利用条件
        以下の注意事項を良くお読みになって服用してください。

         o 著作権は小林 隆生及びInterfairが保有します。

         o このプログラムを実行して起こり得た損害について、 一切責任を負わな
           いものとします。 補償もしません。'95 7/1 からPL法が施行されるよう
           ですが、本プログラムもその対象となるならば、 その時点でサポートを
           一切打ち切ります(フリーソフトだから。シェアウェアならわからんでも
           ないが)。

         o ソースの改編後のuploadも許可します。  連絡は必要ありません。 ただ
           し、その旨をドキュメントに明確に書いてあることを条件とします...と
           しておいたのですが、面倒くさいのでやめます。 自分のつかいやすよう
           にパッチなどを当てて使用して下さい。

         o 転載する場合は、 本体・ソース・ドキュメントすべてを転載するように
           してください。 連絡は必要ありません。 でも、 もらったらうれしいな
           (笑)。

         o バグ修正は、最新版について行います。 ローカルバージョンには行いま
           せん(笑)。またバグ修正を行う義務は作者には一切ないものとします。

         o 組み込み後のプログラムの配布は、商的利用、 非商的利用どちらも構い
           ません。連絡不要です。でも、DOCファイルに書いてあったら結構嬉しい
           かも:)また、DDN,XDV単体での組み込みも構いません。

         o このソフトウェアは、Free Software として公開します。 一部のマクロ
           ファイルを除き、PDSではありません。取り扱いに注意して下さい。

        これらの条件を満たすものだけに許可します。

    ○連絡先


                                   - 7 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC


         ABA/小林 隆生  ISL-NET    isl30126
                        E-Mail     s95702@polaris.yatsushiro-nct.ac.jp
         TEANAN/山本 弘 NiftyServe HGA02466
                        ISL-NET    isl31480


    ○たわごと
          もし、このソフトウェアとかを気に入って下さった方は金欠の私(笑)にご
        寄付をよろしくお願いしますo(._.)o。 ご寄付で食べたりして、新しいもの
        を開発する意欲になりますから。

      肥後銀行八代駅前支店 普通口座 店番255 口座番号XXXXXXX 小林 隆生

        宜しくお願いいたします。


○History
    Version  Release  Comment

    0.01B    1.1      とりあえず完成。

    0.60     1.2      安定動作するようになった。バッファをきれいに初期化
                      するようにした。演奏カウンタファンクション追加。実
                      用できるよん。やっと(笑)。

    0.70     1.3      チェインバッファシステムを採用した！

    0.80     1.4      DCMファンクションを追加。ドライバ毎のlocalな制御が
                      できるよ(いわゆる効果音API??)。

    0.82     1.5      DCMのBugfix。

    0.82++   1.5.1    DCMのBugfix。

    0.84++   1.5.2    sustenuto,tenuto,hold1,poltamentのBugfix。

    0.85     1.6      Chg.ChannelのBIN仕様追加に伴う機能拡張(暫定版)

    0.87     1.7      繰り返し抜けをサポートした。

    0.90     1.8      FAR

    0.95     1.9      TIMERDRVの仕様変更に伴うプログラム変更(昔のTIMERド
                      ライバは使用不可デー素)

    0.99     1.10     ECM機能追加、すべてのXMMLformatを満たした

    0.99A    1.11     ETCDRVのECM機能が使えない

    1.10     1.12     おー(ﾊﾟﾁﾊﾟﾁ)v(^^)

    1.10     1.13     ソースをLIB対応にした〜。おー(ﾊﾟﾁﾊﾟﾁ)v(^^)

    1.10     1.14     じゃーん、ノートバッファ対応。鍵盤だせます。

    1.10     1.15     bug修正


                                   - 8 -                             DIL1995




MFXDDN user's manual                                             ver.1.18DOC



    1.12     1.16     繰り返し系のbug修正

    1.14     1.17     マスターボリューム系のbug修正、その他bug修正

    1.18     1.18     おもいっきり修正(^^)

    1.18     2.1      実験的機能を追加1

    1.18     2.2      実験的機能を追加2

    1.18     2.3      実験的機能を追加3

    1.18     3.1      実験的機能を作りなおし(笑)(ひみつ)

※予定

        ぶしぶし。

----------------------------------------------------------------------------
mfxddn.doc was written by Takao Kobayashi in 1995.





































                                   - 9 -                             DIL1995


